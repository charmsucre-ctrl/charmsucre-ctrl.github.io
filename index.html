<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Impressão do Pedido</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <nav class="top-link">
    <a class="btn-link" href="../site-doces/index.html">Ir para o site Charm Sucré</a>
  </nav>

  <div class="pedido-print">
    <header>
      <h1> Comanda Charm Sucré</h1>
      <p></p>
    </header>

    <section class="comanda">
      <div class="comanda-list" id="comanda-list">
        <div class="comanda-card comanda-empty">Nenhuma comanda encontrada. Gere pelo site Charm Sucré.</div>
      </div>
    </section>

    <footer>
      <p></p>
    </footer>
  </div>

  <button onclick="window.print()" class="btn-print">
    Imprimir Pedido
  </button>
  <script>
    (function() {
      const listEl = document.getElementById('comanda-list');
      if (!listEl) return;

      const renderList = () => {
        const raw = localStorage.getItem('comanda-list');
        const list = raw ? JSON.parse(raw) : [];
        listEl.innerHTML = '';
        if (!list.length) {
          const empty = document.createElement('div');
          empty.className = 'comanda-card comanda-empty';
          empty.textContent = 'Nenhuma comanda encontrada. Gere pelo site Charm Sucré.';
          listEl.appendChild(empty);
          return;
        }
        list.slice().reverse().forEach((item, idx) => {
          const card = document.createElement('div');
          card.className = 'comanda-card';
          card.dataset.id = item.id;

          const badge = document.createElement('div');
          badge.className = 'comanda-badge';
          badge.textContent = `#${list.length - idx}`;

          const pre = document.createElement('pre');
          pre.textContent = item.texto;

          const btnPrint = document.createElement('button');
          btnPrint.className = 'btn-print-card';
          btnPrint.type = 'button';
          btnPrint.textContent = 'Imprimir só esta comanda';
          btnPrint.addEventListener('click', () => {
            document.querySelectorAll('.comanda-card').forEach((c) => c.classList.remove('print-target'));
            card.classList.add('print-target');
            document.body.setAttribute('data-print-target', '1');
            window.print();
            setTimeout(() => {
              document.body.removeAttribute('data-print-target');
              card.classList.remove('print-target');
            }, 300);
          });

          card.appendChild(badge);
          card.appendChild(pre);
          card.appendChild(btnPrint);
          listEl.appendChild(card);
        });
      };

      window.addEventListener('storage', (event) => {
        if (event.key === 'comanda-list') renderList();
      });

      renderList();
    })();
  </script>

</body>
</html>